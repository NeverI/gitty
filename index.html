<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Gitty by gordonwritescode</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Gitty</h1>
        <p class="header">A Node.js wrapper for the Git CLI</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/gordonwritescode/Gitty/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/gordonwritescode/Gitty/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/gordonwritescode/Gitty">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/gordonwritescode">gordonwritescode</a></p>


      </header>
      <section>
        <h2>Overview</h2>

<p>Gitty is a Node.js wrapper for the Git CLI. It's syntax closely resembles the Git command line syntax to asynchronously execute common commands, and parses the output into operable objects - depending on the call.</p>

<h2>Prerequisites</h2>

<ul>
<li>Node.js 0.8.x (<a href="http://nodejs.org">http://nodejs.org</a>)</li>
<li>Git 1.7.x.x (<a href="http://git-scm.com">http://git-scm.com</a>)</li>
<li>Mac OSX or Linux-based System</li>
</ul><h2>Installation</h2>

<pre><code>$ npm install gitty
</code></pre>

<p><strong>Note</strong>: If you encounter an error during installation on Mac OSX, make sure you have the XCode Command Line Tools installed. Gitty depends on <strong>pty.js</strong> for authenticated operations - which requires GCC compiler.</p>

<ol>
<li>Go to the App store and download the latest version of Xcode for free.</li>
<li>Install Xcode (the app store actually downloads the "installer" for Xcode)</li>
<li>Start Xcode</li>
<li>Go to Preferences</li>
<li>Go to Downloads</li>
<li>Click on the "install" button after "Command Line Tools"</li>
<li>Reboot</li>
</ol><h2>Usage</h2>

<p>First, require Gitty.</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">git</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gitty'</span><span class="p">);</span>
</pre></div>

<p>The "meat" of the functionality is encapsulated in instances of a <code>Repository</code> object. This object is instantiated with the path to the repository you wish to perform actions on.</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">myRepo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">git</span><span class="p">.</span><span class="nx">Repository</span><span class="p">(</span><span class="s1">'/path/to/repo'</span><span class="p">);</span>
</pre></div>

<p>Now you can call this instance of <code>Repository</code>'s methods. For example, to execute <code>git log</code> for <code>myRepo</code>, you would do:</p>

<div class="highlight"><pre><span class="nx">myRepo</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">log</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle error</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// do something with `log`  </span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>A complete list of the available methods is below, as well as other Gitty functions.</p>

<h2>Potential Use Cases</h2>

<ul>
<li>Writing an exception logger with more insight</li>
<li>Building a web based Git client</li>
<li>Integrating automated deployments</li>
</ul><h2>Documentation</h2>

<h3>Repository(path)</h3>

<p>Creates an instance of <code>gitty.Repository</code> from the given <code>path</code>. Each instance contains the following properties and has access to the following methods.</p>

<h4>Repository.isRepository</h4>

<p><strong>Type</strong>: <code>Boolean</code></p>

<p>Based on the existence of the <code>.git/</code> directory under the instance <code>path</code>.</p>

<h4>Repository.name</h4>

<p><strong>Type</strong>: <code>String</code></p>

<p>Directory name of the instantiated <code>Repository</code>.</p>

<h4>Repository.path</h4>

<p><strong>Type</strong>: <code>String</code></p>

<p>Normalized copy of the instance <code>path</code>.</p>

<h4>Repository.init(callback, flags)</h4>

<p>Initializes the directory as a Git repository.</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><p><strong>flags</strong></p>

<ul>
<li>Type: <code>Array</code>
</li>
<li>Description: Command flags like <code>['--bare','--shared']</code>
</li>
</ul><h4>Repository.log(callback)</h4>

<p>Passes commit history as array to callback</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, log)</code>
</li>
</ul><h4>Repository.status(callback)</h4>

<p>Passes a status object into the callback</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, status)</code>
</li>
</ul><h4>Repository.add(files, callback)</h4>

<p>Stages the passed array of files for commit</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.remove(files, callback)</h4>

<p>Removes the passed array of files for commit</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.unstage(files, callback)</h4>

<p>Removes passed array of files from staging area</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.commit(message, callback)</h4>

<p>Commits the current staged files</p>

<p><strong>message</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Commit message</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, output)</code>
</li>
</ul><h4>Repository.branches(callback)</h4>

<p>Passes object denoting current branch and array of other branches</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, branches)</code>
</li>
</ul><h4>Repository.branch(name, callback)</h4>

<p>Creates a new branch from the given branch name</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.checkout(branch, callback)</h4>

<p>Performs checkout on given branch</p>

<p><strong>branch</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the branch to checkout</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, branches)</code>
</li>
</ul><h4>Repository.merge(branch, callback)</h4>

<p>Performs a merge of the current branch with the specified one</p>

<p><strong>branch</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the branch to merge into current</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.remote.add(name, url, callback)</h4>

<p>Adds a new remote</p>

<p><strong>name</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the remote to add</li>
</ul><p><strong>url</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: URL to set for the new remote</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.remote.setUrl(name, url, callback)</h4>

<p>Changes url of an existing remote</p>

<p><strong>name</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the remote to edit</li>
</ul><p><strong>url</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: URL to set for the existing remote</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.remote.remove(name, callback)</h4>

<p>Removes the specified remote</p>

<p><strong>name</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the remote to remove</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h4>Repository.remote.list(callback)</h4>

<p>Passes key-value pairs to callback formatted: <code>remote : url</code></p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, remotes)</code>
</li>
</ul><h4>Repository.push(remote, branch, callback, creds)</h4>

<p>Pushes the specified branch to the specified remote</p>

<p><strong>remote</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the remote to push to</li>
</ul><p><strong>branch</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the branch to push</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, success)</code>
</li>
</ul><p><strong>creds</strong> (optional)</p>

<ul>
<li>Type: <code>Object</code>
</li>
<li>Description: Formatted as <code>{ user : 'username', pass : 'password' }</code>
</li>
</ul><blockquote>
<p><strong>Note:</strong> This method does not use an instance of <code>Command()</code>, see <em>Authenticated Repositories</em></p>
</blockquote>

<h4>Repository.pull(remote, branch, callback, creds)</h4>

<p>Pulls the specified branch from the specified remote</p>

<p><strong>remote</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the remote to pull from</li>
</ul><p><strong>branch</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of the branch to pull</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, success)</code>
</li>
</ul><p><strong>creds</strong> (optional)</p>

<ul>
<li>Type: <code>Object</code>
</li>
<li>Description: Formatted as <code>{ user : 'username', pass : 'password' }</code>
</li>
</ul><blockquote>
<p><strong>Note:</strong> This method does not use an instance of <code>Command()</code>, see <em>Authenticated Repositories</em></p>
</blockquote>

<h4>Repository.reset(hash, callback)</h4>

<p>Resets the repository's HEAD to the specified commit and passes commit log to callback</p>

<p><strong>hash</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Commit hash identifier to rest to</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, log)</code>
</li>
</ul><h3>Command(path, operation, flags, options)</h3>

<p>Creates an instance of <code>gitty.Command</code> from the given arguments. This is constructor is used primarily internally, for executing <code>Repository</code> methods, however, it is exposed - see <em>Extending Gitty</em>. Each instance contains the following properties and has access to the following methods.</p>

<h4>Command.repo</h4>

<p><strong>Type</strong>: <code>String</code></p>

<p>Directory path for the instantiated <code>Command</code> object</p>

<h4>Command.command</h4>

<p><strong>Type</strong>: <code>String</code></p>

<p>Assembled command string based on the instantiated <code>operation</code>, <code>flags</code>, and <code>options</code></p>

<h4>Command.exec(callback)</h4>

<p>Executes a <code>child_process</code> by the instance's <code>command</code> property in the directory specified by the instance's <code>path</code> property</p>

<p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, stdout, stderr)</code>
</li>
</ul><blockquote>
<p><strong>Note:</strong> This is a wrapper for Node's <code>child_process.exec</code> that, first, validates the path as a Git repository before execution. If the path fails validation, an <code>Error</code> will be thrown.</p>
</blockquote>

<h3>config(key, value, callback)</h3>

<p>Does global Git configuration</p>

<p><strong>key</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Name of configuration property to set</li>
</ul><p><strong>value</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Value to set to the named configuration property</li>
</ul><p><strong>callback</strong> (optional)</p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err)</code>
</li>
</ul><h3>clone(path, url, callback, creds)</h3>

<p>Clones the repository at <code>url</code> into the specified <code>path</code></p>

<p><strong>path</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Path to directory to clone into</li>
</ul><p><strong>url</strong></p>

<ul>
<li>Type: <code>String</code>
</li>
<li>Description: Url of the Git repository to clone</li>
</ul><p><strong>callback</strong></p>

<ul>
<li>Type: <code>Function</code>
</li>
<li>Description: Receives argument(s): <code>(err, success)</code>
</li>
</ul><p><strong>creds</strong> (optional)</p>

<ul>
<li>Type: <code>Object</code>
</li>
<li>Description: Formatted as <code>{ user : 'username', pass : 'password' }</code>
</li>
</ul><blockquote>
<p><strong>Note:</strong> This method does not use an instance of <code>Command()</code>, see <em>Authenticated Repositories</em></p>
</blockquote>

<h2>Authenticated Repositories</h2>

<p>One challenge that was faced while developing Gitty was performing any authenticated operations. Since OpenSSH does not read input from <code>stdin</code> for authentication, but rather a psuedo-terminal - Gitty uses <em>pty.js</em> (<a href="https://github.com/chjj/pty.js/">https://github.com/chjj/pty.js/</a>) to spawn a pseudo-terminal for operations that may require authentication, such as <code>pull</code>, <code>push</code>, and <code>clone</code>.</p>

<p>Credentials are always passed as the last argument and are optional. Below is an example of an authenticated <code>Repository.push()</code>.</p>

<div class="highlight"><pre><span class="c1">// do authenticated push to origin</span>
<span class="nx">myRepo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">'origin'</span><span class="p">,</span> <span class="s1">'master'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">succ</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">succ</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="nx">user</span> <span class="o">:</span> <span class="s1">'username'</span><span class="p">,</span>
    <span class="nx">pass</span> <span class="o">:</span> <span class="s1">'password'</span>
<span class="p">});</span>
</pre></div>

<p>This format is consistent for all authenticated operations. Keep this in mind if you are extending Gitty with an operation that requires authentication, and be sure to read the pty.js documentation.</p>

<h2>Extending Gitty</h2>

<p>Almost all of the <code>Repository</code> methods are simply convenience wrappers around instances of <code>Command</code>. This makes extending the <code>Repository</code> constructor with custom methods easy as pie! Let's run through a quick example. Let's say we want to add a method for creating a new branch and automatically switching to it. What do we need to do?</p>

<ol>
<li>Extend the <code>Repository</code> prototype</li>
<li>Create a new instance of <code>Command</code>
</li>
<li>Parse the output and pass to a callback</li>
</ol><p>Three steps is all it should take to add a new method to the <code>Repository</code> constructor, and below is how you might do it.</p>

<div class="highlight"><pre><span class="c1">// require gitty</span>
<span class="kd">var</span> <span class="nx">git</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gitty'</span><span class="p">);</span>

<span class="c1">// create new prototype endpoint</span>
<span class="c1">// we want to pass a branch name and callback into this method</span>
<span class="nx">git</span><span class="p">.</span><span class="nx">Repository</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">branchAndCheckout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// save the scope of the repository</span>
    <span class="kd">var</span> <span class="nx">repo</span> <span class="o">=</span> <span class="k">this</span>
    <span class="c1">// create a new instance of Command</span>
      <span class="p">,</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">git</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="s1">'checkout'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'-b'</span><span class="p">],</span> <span class="nx">name</span><span class="p">);</span>

    <span class="c1">// execute the command and determine the outcome</span>
    <span class="nx">cmd</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">error</span> <span class="o">||</span> <span class="nx">stderr</span><span class="p">;</span>

        <span class="c1">// call the callback function in the repository scope</span>
        <span class="c1">// passing it err and stdout</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">repo</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>It's a simple as that. Now you would be able to use this custom method in your application, like so:</p>

<div class="highlight"><pre><span class="nx">myRepo</span><span class="p">.</span><span class="nx">branchAndCheckout</span><span class="p">(</span><span class="s1">'myBranch'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// throw error</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<h2>The Output Parser</h2>

<p>The output parser is simply a collection of functions that accept the string output of an executed command, and turn it into something that can be operated on. For example, the output from <code>git log</code> gets converted to an array of object-literals before being returned back to the callback for <code>Repository.log()</code>. </p>

<h2>Contributing</h2>

<p>One of the reasons I have tried to make Gitty so easy to extend is, well, because I want you to extend it! It is not a wrapper for every possible Git operation, but it most certainly could be, and with minimal coding too! Contributions are always welcome and encouraged. However, to keep Gitty clean and healthy, before making additions consider the following:</p>

<ol>
<li>Does my addition follow the conventions already in place?</li>
<li>Does my code belong where I have placed it?</li>
<li>Does my syntax resemble the Git CLI?</li>
</ol><p>If you can answer "yes" to these 3 questions, then send a pull request!</p>

<h2>Author</h2>

<p>Gitty was written by Gordon Hall (<a href="mailto:gordon@gordonwritescode.com">gordon@gordonwritescode.com</a>)<br>
Licensed under MIT license</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-34751108-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>